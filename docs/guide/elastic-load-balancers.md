# Elastic Load Balancers

## Uses:
- Spreads load across downstream instances
- Expose single point access (DNS) to app
- Handles failure of downstream instances via health checks
- Provides SSL HTTPS termination
- Enforcing stickiness with cookies
- High Availability across zones
- Separate public and private traffic



## Health Checks
- Tells load balancer if instances are available to reply to requests
- Done on port and route /health
- If response is not 200 (ok) then instance is unhealthy

## Application Load Balancer
- Load balance to multiple HTTP apps across machines
- Load balance to multiple apps on same machine (ie containers)
- Load balancing based on route or hostname in URL
- Port mapping can redirect to dynamic port
- Supports HTTP/HTTPS & Websockets protocols
- Supports SSL certs and provides SSL termination
- Doesn't support static IP, has fixed DNS

::: tip ALB Tips

Stickiness can be enabled at target group level
- Same request goes to same instance , generated by ALB (not app)
The app servers don't see IP of client directly
- True IP of client in header X-Forwarded-For
- Can also get X-Forwarded-Port and X-Forwarded Proto
:::

### Stickiness
Use so user doesn't lose session
Control expiration with cookie
May bring imbalance to backend EC2 load




## Network Load Balancer
Use for extreme performance, shouldn't be default choice
- Forward Layer 4 TCP traffic
- Handle millions of requests per second
- Support static or elastic IP
- Lower latency ~100ms (400ms for ALB)
- Direct sight of client IP
- No pre-warming needed
- No SSL termination (ust enable by application)

## Load Balancer Tips

Chain an NLB and ALB to "give" fixed IP

All Load Balancers have health check ability

Load balancers have static host names

Can scale but not instant, contact AWS for "warm-up"

Check security group if LB can't connect to app!

Error codes
- 200 Successful request
- 4xx are client errors
- 5xx are app errors
- 503 = at capacity or no registered target

## Load Balancer Monitoring

Metrics directly pushed to CloudWatch

- BackendConnectionErrors
- Healthy/UnHealthy HostCount
- HTTPCode_Backend2XX Successful Request
- HTTPCode_Backend_3XX Redirected Request
- HTTPCode_ELB_4XX Client error codes
- HTTPCode_ELB_5XX Server error codes by LB
- Latency
- RequestCount

SurgeQueueLength:
- Help scale out ASG, max value 1024
- Total number of request/connections pending routing to healthy instance
- SpilloverCount: total number of requests rejected because surge queue full

Load Balancer Access Logs:
Logs can be stored in S3 & contain:
- Time, Client IP, Latencies, Request paths, Response, Trace Id
